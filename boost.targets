<!--
***********************************************************************************************


WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your projects from the command-line or the IDE.



Copyright (C) 
***********************************************************************************************
-->

<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  
  <PropertyGroup Label="Build Options">
    <boost-options />
  </PropertyGroup>
  
  <ItemGroup Label="Local difinitions">
    <BuildEnvVars Include="VS_UNICODE_OUTPUT=" />
    <EngineSourceFiles Include="$(BoostDir)\tools\build\src\engine\*.h" />
    <EngineSourceFiles Include="$(BoostDir)\tools\build\src\engine\*.c" />
  </ItemGroup>

  <Target Name="PrepareForBoostBuild" Label="Prepare boost build options">
    <PropertyGroup>
      <!--Toolset-->
      <boost-options>toolset=msvc</boost-options>
      <boost-options Condition="'$(PlatformToolset)'!='' And 
                                '$(PlatformToolset)'!='$(DefaultPlatformToolset)'">$(boost-options)$([System.String]::Format('-{0}.{1}', $(PlatformToolset.Substring(1, 2)), $(PlatformToolset.Substring(3,1))))</boost-options>
      <!--Configuration Manager-->
      <boost-options>$(boost-options)&#32;address-model=$(PlatformArchitecture)&#32;variant=$(Configuration.ToLower())</boost-options>
      <!--General-->
      <boost-options Condition="'$(OutDir)'!='stage\' and 
                                '$(OutDir)'!=''"                       >$(boost-options)&#32;--stage-dir="$(OutDir)"</boost-options>
      <boost-options Condition="'$(IntDir)'!=''"                       >$(boost-options)&#32;--build-dir="$(IntDir)"</boost-options>
      <!--Build Settings-->
      <boost-options Condition="'$(boost-link)'            !=''"       >$(boost-options)&#32;link=$(boost-link)</boost-options>
      <boost-options Condition="'$(boost-runtime-link)'    !=''"       >$(boost-options)&#32;runtime-link=$(boost-runtime-link)</boost-options>
      <boost-options Condition="'$(boost-threading)'       !=''"       >$(boost-options)&#32;threading=$(boost-threading)</boost-options>
      <boost-options Condition="'$(boost-build-type)'      !=''"       >$(boost-options)&#32;--build-type=$(boost-build-type)</boost-options>
      <boost-options Condition="'$(boost-layout)'          !=''"       >$(boost-options)&#32;--layout=$(boost-layout)</boost-options>
      <boost-options Condition="'$(boost-windows-api)'     !=''"       >$(boost-options)&#32;windows-api=$(boost-windows-api)</boost-options>
      <boost-options Condition="'$(boost-build-type)'      !='minimal'">$(boost-options)&#32;stage"</boost-options>
      <boost-options Condition="'$(AdditionalOptions)'     !=''"       >$(boost-options)&#32;$(AdditionalOptions)</boost-options>
      <!--Libraries-->
      <boost-options Condition="'$(atomic_library)'          =='true' ">$(boost-options)&#32;--with-atomic</boost-options>
      <boost-options Condition="'$(chrono_library)'          =='true' ">$(boost-options)&#32;--with-chrono</boost-options>
      <boost-options Condition="'$(container_library)'       =='true' ">$(boost-options)&#32;--with-container</boost-options>
      <boost-options Condition="'$(context_library)'         =='true' ">$(boost-options)&#32;--with-context</boost-options>
      <boost-options Condition="'$(coroutine_library)'       =='true' ">$(boost-options)&#32;--with-coroutine</boost-options>
      <boost-options Condition="'$(date_time_library)'       =='true' ">$(boost-options)&#32;--with-date_time</boost-options>
      <boost-options Condition="'$(exception_library)'       =='true' ">$(boost-options)&#32;--with-exception</boost-options>
      <boost-options Condition="'$(filesystem_library)'      =='true' ">$(boost-options)&#32;--with-filesystem</boost-options>
      <boost-options Condition="'$(graph_library)'           =='true' ">$(boost-options)&#32;--with-graph</boost-options>
      <boost-options Condition="'$(graph_parallel_library)'  =='true' ">$(boost-options)&#32;--with-graph_parallel</boost-options>
      <boost-options Condition="'$(iostreams_library)'       =='true' ">$(boost-options)&#32;--with-iostreams</boost-options>
      <boost-options Condition="'$(locale_library)'          =='true' ">$(boost-options)&#32;--with-locale</boost-options>
      <boost-options Condition="'$(log_library)'             =='true' ">$(boost-options)&#32;--with-log</boost-options>
      <boost-options Condition="'$(math_library)'            =='true' ">$(boost-options)&#32;--with-math</boost-options>
      <boost-options Condition="'$(mpi_library)'             =='true' ">$(boost-options)&#32;--with-mpi</boost-options>
      <boost-options Condition="'$(program_options_library)' =='true' ">$(boost-options)&#32;--with-program_options</boost-options>
      <boost-options Condition="'$(python_library)'          =='true' ">$(boost-options)&#32;--with-python</boost-options>
      <boost-options Condition="'$(random_library)'          =='true' ">$(boost-options)&#32;--with-random</boost-options>
      <boost-options Condition="'$(regex_library)'           =='true' ">$(boost-options)&#32;--with-regex</boost-options>
      <boost-options Condition="'$(serialization_library)'   =='true' ">$(boost-options)&#32;--with-serialization</boost-options>
      <boost-options Condition="'$(signals_library)'         =='true' ">$(boost-options)&#32;--with-signals</boost-options>
      <boost-options Condition="'$(system_library)'          =='true' ">$(boost-options)&#32;--with-system</boost-options>
      <boost-options Condition="'$(test_library)'            =='true' ">$(boost-options)&#32;--with-test</boost-options>
      <boost-options Condition="'$(thread_library)'          =='true' ">$(boost-options)&#32;--with-thread</boost-options>
      <boost-options Condition="'$(timer_library)'           =='true' ">$(boost-options)&#32;--with-timer</boost-options>
      <boost-options Condition="'$(wave_library)'            =='true' ">$(boost-options)&#32;--with-wave</boost-options>
      <boost-options Condition="'$(atomic_library)'          =='false'">$(boost-options)&#32;--without-atomic</boost-options>
      <boost-options Condition="'$(chrono_library)'          =='false'">$(boost-options)&#32;--without-chrono</boost-options>
      <boost-options Condition="'$(container_library)'       =='false'">$(boost-options)&#32;--without-container</boost-options>
      <boost-options Condition="'$(context_library)'         =='false'">$(boost-options)&#32;--without-context</boost-options>
      <boost-options Condition="'$(coroutine_library)'       =='false'">$(boost-options)&#32;--without-coroutine</boost-options>
      <boost-options Condition="'$(date_time_library)'       =='false'">$(boost-options)&#32;--without-date_time</boost-options>
      <boost-options Condition="'$(exception_library)'       =='false'">$(boost-options)&#32;--without-exception</boost-options>
      <boost-options Condition="'$(filesystem_library)'      =='false'">$(boost-options)&#32;--without-filesystem</boost-options>
      <boost-options Condition="'$(graph_library)'           =='false'">$(boost-options)&#32;--without-graph</boost-options>
      <boost-options Condition="'$(graph_parallel_library)'  =='false'">$(boost-options)&#32;--without-graph_parallel</boost-options>
      <boost-options Condition="'$(iostreams_library)'       =='false'">$(boost-options)&#32;--without-iostreams</boost-options>
      <boost-options Condition="'$(locale_library)'          =='false'">$(boost-options)&#32;--without-locale</boost-options>
      <boost-options Condition="'$(log_library)'             =='false'">$(boost-options)&#32;--without-log</boost-options>
      <boost-options Condition="'$(math_library)'            =='false'">$(boost-options)&#32;--without-math</boost-options>
      <boost-options Condition="'$(mpi_library)'             =='false'">$(boost-options)&#32;--without-mpi</boost-options>
      <boost-options Condition="'$(program_options_library)' =='false'">$(boost-options)&#32;--without-program_options</boost-options>
      <boost-options Condition="'$(python_library)'          =='false'">$(boost-options)&#32;--without-python</boost-options>
      <boost-options Condition="'$(random_library)'          =='false'">$(boost-options)&#32;--without-random</boost-options>
      <boost-options Condition="'$(regex_library)'           =='false'">$(boost-options)&#32;--without-regex</boost-options>
      <boost-options Condition="'$(serialization_library)'   =='false'">$(boost-options)&#32;--without-serialization</boost-options>
      <boost-options Condition="'$(signals_library)'         =='false'">$(boost-options)&#32;--without-signals</boost-options>
      <boost-options Condition="'$(system_library)'          =='false'">$(boost-options)&#32;--without-system</boost-options>
      <boost-options Condition="'$(test_library)'            =='false'">$(boost-options)&#32;--without-test</boost-options>
      <boost-options Condition="'$(thread_library)'          =='false'">$(boost-options)&#32;--without-thread</boost-options>
      <boost-options Condition="'$(timer_library)'           =='false'">$(boost-options)&#32;--without-timer</boost-options>
      <boost-options Condition="'$(wave_library)'            =='false'">$(boost-options)&#32;--without-wave</boost-options>
    </PropertyGroup>
  </Target>


  <Target Name="BuildJamTool" Label="Building BJAM engine"
          Inputs="@(EngineSourceFiles)" 
          Outputs="$(BoostDir)\b2.exe" >
    <Error ContinueOnError="false" Text="Engine source files are missing, did you update submodules?" Condition="@(EngineSourceFiles)==''" />
    <Message Text="Building Engine..." Importance="high" />
    <Exec Command="call build.bat" WorkingDirectory="$(BoostDir)\tools\build\src\engine\" EnvironmentVariables="@(BuildEnvVars)" />
    
    <ItemGroup Label="List all built exe files" >
      <BJamTools Include="$(BoostDir)\tools\build\src\engine\bin.ntx86\*.exe" Condition="Exists('$(BoostDir)\tools\build\src\engine\bin.ntx86')" />
      <BJamTools Include="$(BoostDir)\tools\build\src\engine\bin.ntx86_64\*.exe" Condition="Exists('$(BoostDir)\tools\build\src\engine\bin.ntx86_64')" />
    </ItemGroup>
    <Copy SourceFiles="@(BJamTools)" DestinationFolder="$(BoostDir)\" UseHardlinksIfPossible="true" />
  </Target>


  <Target Name="BoostHeaders" DependsOnTargets="BuildJamTool"
          Label="Populate 'boost' include dir if missing"
          Condition="!Exists('$(BoostDir)\boost')" >
    <PropertyGroup>
      <CommandLine>b2.exe toolset=msvc headers  --build-dir="$(IntDir)"</CommandLine>
    </PropertyGroup>
    <Message Text="Populating 'boost' include dir..." Importance="high" />
    <Exec Command="$(CommandLine)"  WorkingDirectory="$(BoostDir)" EnvironmentVariables="@(BuildEnvVars)" />
  </Target>


  <!--Standard targets-->
  
  <Target Name="Build" DependsOnTargets="BuildJamTool;BoostHeaders;PrepareForBoostBuild;" >
    <Error Condition="$(boost-options.Substring(0, 12))!='toolset=msvc'" Text="Invalid boost options: 'boost-options' element has been overwritten in one of the targets." ContinueOnError="false" />
    <PropertyGroup>
      <CommandLine>b2.exe $(boost-options)</CommandLine>
    </PropertyGroup>
    <Message Text="CommandLine : $(CommandLine)" Importance="high" />

    <Message Text="Building boost..." Importance="high" />
    <Exec Command="$(CommandLine)" WorkingDirectory="$(BoostDir)" EnvironmentVariables="@(BuildEnvVars)" />
  </Target>

  <Target Name="Rebuild" DependsOnTargets="BuildJamTool;BoostHeaders;PrepareForBoostBuild;">
    <Error Condition="$(boost-options.Substring(0, 12))!='toolset=msvc'" Text="Invalid boost options: 'boost-options' element has been overwritten in one of the targets." ContinueOnError="false" />
    <PropertyGroup>
      <CommandLine>b2.exe $(boost-options)</CommandLine>
    </PropertyGroup>
    
    <Message Text="CommandLine : $(CommandLine)" Importance="high" />

    <Message Text="Rebuilding boost..." Importance="high" />
    <!--<Exec Command="b2.exe $(boost-options) -a" WorkingDirectory="$(BoostDir)" EnvironmentVariables="@(BuildEnvVars)" />-->
  </Target>

  <Target Name="Clean" DependsOnTargets="BuildJamTool;PrepareForBoostBuild" >
    <PropertyGroup>
      <CommandLine>b2.exe --stage-dir="$(OutDir) --build-dir="$(IntDir) --clean</CommandLine>
    </PropertyGroup>
    <Message Text="Cleaning boost..." Importance="high" />
    <Exec Command="$(CommandLine)"  WorkingDirectory="$(BoostDir)" EnvironmentVariables="@(BuildEnvVars)" />
  </Target>

  <ItemDefinitionGroup>
    <ClCompile>
      <RuntimeLibrary                   Condition="'%(ClCompile.RuntimeLibrary)'                == ''">MultiThreadedDebugDll</RuntimeLibrary>
      <BasicRuntimeChecks               Condition="'%(ClCompile.BasicRuntimeChecks)'            == ''">EnableFastChecks</BasicRuntimeChecks>
      <Optimization                     Condition="'%(ClCompile.Optimization)'                  == ''">Disabled</Optimization>
      <MinimalRebuild                   Condition="'%(ClCompile.MinimalRebuild)'                == ''">true</MinimalRebuild>
      <AssemblerOutput                  Condition="'%(ClCompile.AssemblerOutput)'               == ''">NoListing</AssemblerOutput>
      <AssemblerListingLocation         Condition="'%(ClCompile.AssemblerListingLocation)'      == ''">$(IntDir)</AssemblerListingLocation>
      <AcceptableNonZeroExitCodes       Condition="'%(ClCompile.AcceptableNonZeroExitCodes)'    == ''">$(AcceptableNonZeroExitCodes)</AcceptableNonZeroExitCodes>
      <UndefineAllPreprocessorDefinitions Condition="'%(ClCompile.UndefineAllPreprocessorDefinitions)' == ''">false</UndefineAllPreprocessorDefinitions>
      <BrowseInformation                Condition="'%(ClCompile.BrowseInformation)'             == ''">false</BrowseInformation>
      <BrowseInformationFile            Condition="'%(ClCompile.BrowseInformationFile)'         == ''">$(IntDir)</BrowseInformationFile>
      <BasicRuntimeChecks               Condition="'%(ClCompile.BasicRuntimeChecks)'            == ''">Default</BasicRuntimeChecks>
      <CompileAs                        Condition="'%(ClCompile.CompileAs)'                     == ''">Default</CompileAs>
      <DisableLanguageExtensions        Condition="'%(ClCompile.DisableLanguageExtensions)'     == ''">false</DisableLanguageExtensions>
      <ErrorReporting                   Condition="'%(ClCompile.ErrorReporting)'                == ''
                                                   and '$(BuildingInsideVisualStudio)'          == 'true'">Prompt</ErrorReporting>
      <ErrorReporting                   Condition="'%(ClCompile.ErrorReporting)'                == ''">Queue</ErrorReporting>
      <ExpandAttributedSource           Condition="'%(ClCompile.ExpandAttributedSource)'        == ''">false</ExpandAttributedSource>
      <ExceptionHandling                Condition="'%(ClCompile.ExceptionHandling)'             == ''">Sync</ExceptionHandling>
      <EnableFiberSafeOptimizations     Condition="'%(ClCompile.EnableFiberSafeOptimizations)'  == ''">false</EnableFiberSafeOptimizations>
      <EnableEnhancedInstructionSet     Condition="'%(ClCompile.EnableEnhancedInstructionSet)'  == ''">NotSet</EnableEnhancedInstructionSet>
      <FloatingPointModel               Condition="'%(ClCompile.FloatingPointModel)'            == ''">Precise</FloatingPointModel>
      <ForceConformanceInForLoopScope   Condition="'%(ClCompile.ForceConformanceInForLoopScope)'== ''">true</ForceConformanceInForLoopScope>
      <ForcedIncludeFiles               Condition="'%(ClCompile.ForcedIncludeFiles)'            == ''"></ForcedIncludeFiles>
      <ForcedUsingFiles                 Condition="'%(ClCompile.ForcedUsingFiles)'              == ''"></ForcedUsingFiles>
      <GenerateXMLDocumentationFiles    Condition="'%(ClCompile.GenerateXMLDocumentationFiles)' == ''">false</GenerateXMLDocumentationFiles>
      <InlineFunctionExpansion          Condition="'%(ClCompile.InlineFunctionExpansion)'       == ''">Default</InlineFunctionExpansion>
      <IntrinsicFunctions               Condition="'%(ClCompile.IntrinsicFunctions)'            == ''">false</IntrinsicFunctions>
      <IgnoreStandardIncludePath        Condition="'%(ClCompile.IgnoreStandardIncludePath)'     == ''">false</IgnoreStandardIncludePath>
      <MinimalRebuild                   Condition="'%(ClCompile.MinimalRebuild)'                == '' and
                                                  ('$(CLRSupport)'                              == '' or
                                                   '$(CLRSupport)'                              == 'false')">false</MinimalRebuild>
      <OmitDefaultLibName               Condition="'%(ClCompile.OmitDefaultLibName)'            == ''">false</OmitDefaultLibName>
      <FavorSizeOrSpeed                 Condition="'%(ClCompile.FavorSizeOrSpeed)'              == ''">Neither</FavorSizeOrSpeed>
      <WholeProgramOptimization         Condition="'%(ClCompile.WholeProgramOptimization)'      == ''">false</WholeProgramOptimization>
      <Optimization                     Condition="'%(ClCompile.Optimization)'                  == '' and
                                                   ('%(ClCompile.BasicRuntimeChecks)'           == '' or
                                                   '%(ClCompile.BasicRuntimeChecks)'            == 'Default')">MaxSpeed</Optimization>
      <ObjectFileName                   Condition="'%(ClCompile.ObjectFileName)'                == ''">$(IntDir)</ObjectFileName>
      <CallingConvention                Condition="'%(ClCompile.CallingConvention)'             == '' and
                                                  ('$(CLRSupport)'                              == '' or
                                                   '$(CLRSupport)'                              == 'false')">Cdecl</CallingConvention>
      <ProgramDataBaseFileName          Condition="'%(ClCompile.ProgramDataBaseFileName)'       == '' and
                                                   '$(ConfigurationType)'                       == 'StaticLibrary'">$(IntDir)$(ProjectName).pdb</ProgramDataBaseFileName>
      <ProgramDataBaseFileName          Condition="'%(ClCompile.ProgramDataBaseFileName)'       == '' and
                                                   '$(PlatformToolsetVersion)'                  != ''">$(IntDir)vc$(PlatformToolsetVersion).pdb</ProgramDataBaseFileName>
      <PrecompiledHeader                Condition="'%(ClCompile.PrecompiledHeader)'             == ''">NotUsing</PrecompiledHeader>
      <PrecompiledHeaderFile            Condition="'%(ClCompile.PrecompiledHeaderFile)'         == ''">stdafx.h</PrecompiledHeaderFile>
      <PrecompiledHeaderOutputFile      Condition="'%(ClCompile.PrecompiledHeaderOutputFile)'   == ''">$(IntDir)$(TargetName).pch</PrecompiledHeaderOutputFile>
      <ProgramDataBaseFileName          Condition="'%(ClCompile.ProgramDataBaseFileName)'       == ''">$(IntDir)vc140.pdb</ProgramDataBaseFileName>
      <PreprocessToFile                 Condition="'%(ClCompile.PreprocessToFile)'              == ''">false</PreprocessToFile>
      <PreprocessKeepComments           Condition="'%(ClCompile.PreprocessKeepComments)'        == ''">false</PreprocessKeepComments>
      <PreprocessSuppressLineNumbers    Condition="'%(ClCompile.PreprocessSuppressLineNumbers)' == ''">false</PreprocessSuppressLineNumbers>
      <ProcessorNumber                  Condition="'$(CL_MPCount)'                              != ''">$(CL_MPCount)</ProcessorNumber>
      <RuntimeLibrary                   Condition="'%(ClCompile.RuntimeLibrary)'                == ''">MultiThreadedDll</RuntimeLibrary>
      <ShowIncludes                     Condition="'%(ClCompile.ShowIncludes)'                  == ''">false</ShowIncludes>
      <SuppressStartupBanner            Condition="'%(ClCompile.SuppressStartupBanner)'         == ''">true</SuppressStartupBanner>
      <BufferSecurityCheck              Condition="'%(ClCompile.BufferSecurityCheck)'           == ''">true</BufferSecurityCheck>
      <StructMemberAlignment            Condition="'%(ClCompile.StructMemberAlignment)'         == ''">Default</StructMemberAlignment>
      <SmallerTypeCheck                 Condition="'%(ClCompile.SmallerTypeCheck)'              == ''">false</SmallerTypeCheck>
      <TrackerLogDirectory              Condition="'%(ClCompile.TrackerLogDirectory)'           == ''">$(TLogLocation)</TrackerLogDirectory>
      <MinimalRebuildFromTracking       Condition="'%(ClCompile.MinimalRebuildFromTracking)'    == ''">true</MinimalRebuildFromTracking>
      <TreatWarningAsError              Condition="'%(ClCompile.TreatWarningAsError)'           == ''">false</TreatWarningAsError>
      <TreatWChar_tAsBuiltInType        Condition="'%(ClCompile.TreatWChar_tAsBuiltInType)'     == ''">true</TreatWChar_tAsBuiltInType>
      <UseFullPaths                     Condition="'%(ClCompile.UseFullPaths)'                  == ''">false</UseFullPaths>
      <WarningLevel                     Condition="'%(ClCompile.WarningLevel)'                  == ''">Level1</WarningLevel>
      <XMLDocumentationFileName         Condition="'%(ClCompile.XMLDocumentationFileName)'      == ''">$(IntDir)</XMLDocumentationFileName>
      <DebugInformationFormat           Condition="'%(ClCompile.DebugInformationFormat)'        == ''">ProgramDatabase</DebugInformationFormat>
    </ClCompile>
  </ItemDefinitionGroup>
  
  <!-- Property pages -->
  <ItemGroup>
    <PropertyPageSchema Include="$(ProjectDir)\boost.xml" >
      <Context>Project</Context>
    </PropertyPageSchema>

    <PropertyPageSchema Include="cl.xml" />
    <PropertyPageSchema Include="link.xml" />

    <ProjectTools Include="ConfigurationGeneral" />
    <ProjectTools Include="linkflags" />    
    <ProjectTools Include="cxxflags" />
  </ItemGroup>

</Project>